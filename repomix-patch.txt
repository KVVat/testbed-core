File: settings.gradle.kts
rootProject.name = "testbed-core"

// リポジトリ定義を一括管理。これにより「no repositories are defined」を解消
dependencyResolutionManagement {
    repositories {
        google()
        mavenCentral()
        maven { url = uri("[https://maven.pkg.jetbrains.space/public/p/compose/developer](https://maven.pkg.jetbrains.space/public/p/compose/developer)") }
    }
}

include(":composeApp")
include(":test-plugin")

File: composeApp/build.gradle.kts
import org.jetbrains.kotlin.gradle.dsl.JvmTarget

plugins {
    kotlin("multiplatform")
    id("org.jetbrains.compose")
    id("org.jetbrains.kotlin.plugin.compose")
}

kotlin {
    jvm()

    sourceSets {
        val jvmMain by getting {
            dependencies {
                implementation(compose.desktop.currentOs)
                // 既存の依存関係を維持しつつ、必要なものを追加
                implementation(libs.junit)
                implementation("com.malinskiy.adam:adam:0.5.10")
                implementation("org.jetbrains.kotlinx:kotlinx-coroutines-core:1.8.0")
            }
        }
        val jvmTest by getting {
            dependencies {
                implementation(kotlin("test"))
            }
        }
    }
}

compose.desktop {
    application {
        mainClass = "org.example.project.MainKt"
        nativeDistributions {
            targetFormats(org.jetbrains.compose.desktop.application.dsl.TargetFormat.Dmg, org.jetbrains.compose.desktop.application.dsl.TargetFormat.Msi, org.jetbrains.compose.desktop.application.dsl.TargetFormat.Deb)
            packageName = "org.example.project"
            packageVersion = "1.0.0"
        }
    }
}

File: test-plugin/build.gradle.kts
plugins {
    kotlin("jvm")
}

dependencies {
    // メインアプリのクラス（AdbDeviceRule, JUnitBridge等）を参照
    implementation(project(":composeApp"))

    // JUnit 4 (本体と合わせる)
    implementation("junit:junit:4.13.2")

    // adam (0.5.10)
    implementation("com.malinskiy.adam:adam:0.5.10")
}

tasks.jar {
    archiveFileName.set("sample-test-plugin.jar")
    // ビルドしたJARをメインアプリが読み込む plugins ディレクトリへ自動出力
    destinationDirectory.set(file("${rootProject.projectDir}/plugins"))
}